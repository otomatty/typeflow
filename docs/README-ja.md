# TypeFlow 日本語ドキュメント（初版）

本書は現時点の実装状況を整理し、PRDに沿った今後の開発指針を示します。随時アップデートしていきます。

## プロジェクト概要
- **目的**: エンジニア向けのタイピング練習（技術語やコード断片）をウィジェット感覚で素早く行う。
- **キーワード**: ローカル完結・即時フィードバック・弱点強化・狭い画面でも使えるUI。
- **技術スタック**: Vite + React 19, TypeScript, Tailwind, framer-motion, Radix UI, wanakana（仮名/ローマ字変換）, @github/spark(useKV) でローカル永続化。

## 現状の実装サマリ
- **単語管理**: ダイアログから入力。自動でひらがな/ローマ字生成（wanakana）。Sparkの `useKV` でローカル保存・削除可。
- **ゲーム開始**: 登録語彙からランダムシャッフルで10秒タイムアタックを開始。正解で残り時間を最大 +3 秒まで回復。
- **入力検証**: キーダウンをグローバルに監視。`validateRomajiInput` でローマ字バリエーション(shi/si, chi/ti, tsu/tu, fu/hu, ji/zi)を許容。誤り時は赤フラッシュ。
- **メトリクス**: プレイ中の WPM/ACC/進捗、終了画面の WPM・ACC・正答数・経過時間。
- **弱点リトライ**: 1プレイ中に誤入力を含んだ単語ID一覧を保存し、終了後「Retry Weak Words」でその集合のみを再プレイ。
- **UI**: ダーク基調。Tabsで単語リストと弱点順ソートの簡易統計を表示。TimeGaugeは残量に応じて色変化。
- **ショートカット**: キーボード操作に対応。メニューで `Enter` でゲーム開始、ゲーム中 `Esc` で終了、ゲームオーバー画面で `Enter`（再プレイ）/ `R`（弱点リトライ）/ `Esc`（メニュー）。各ボタンにショートカットヒントを表示。

## PRDとの差分・課題
- **弱点追跡の精度**: 誤入力カウントを一意IDでのみ保持しており、ミスタイプ回数を正確に蓄積していない。ACC算出が「総キー数に対するユニーク誤単語数」でゆがむ。
- **学習優先度**: 弱点語の出現頻度調整や履歴に基づく出題バイアスは未実装。
- **時間/難易度調整**: タイマー固定10秒、補充も固定。ウィジェット/フル画面のサイズ適応はベーシックのみでUX最適化は未着手。
- **ショートカット/即時性**: ~~「Enterで開始」「ダイアログのキーボード操作」~~ → ✅ 実装済み。「デバウンスによる高速入力保護」は未実装。
- **メトリクスの蓄積**: セッション履歴や推移グラフなし。統計タブは弱点一覧のみ。
- **エッジケース処理**: ラピッド入力のキューイング、ローマ字多様性（nn/n 等の扱い）、長文表示の折返し/省略など追加のチューニング余地あり。

## データモデル（現状）
- `Word`: `{ id, text, reading, romaji, stats: { correct, miss, lastPlayed, accuracy } }`
- `GameState`: プレイ進行（残り時間・現在入力・インデックス・ミスタイプ単語ID集合・キー数・開始時刻など）
- `GameStats`: 終了時サマリ（wpm, accuracy, correctWords, totalWords, totalTime）

## ユーザーフロー（現状）
1) 単語追加: テキスト入力 → 自動で読み/ローマ字生成 → 保存（ローカル）。
2) プレイ開始: Startボタン（登録語が無い場合はトーストで促す）。
3) タイピング: 正答で時間回復・次単語へ。誤入力時に赤フラッシュ・弱点ID記録。
4) 終了: タイムアウト or 全問完了 → 終了画面で再挑戦/弱点再挑戦/メニュー戻り。
5) 弱点確認: Tabs「Stats」で精度低い順の単語リストを参照。

## 近日の改善バックログ（提案）
- **精度計算修正**: ミス回数をキー入力単位で加算し、ACC = 正キー/総キーで算出。弱点判定も回数ベースへ。
- **弱点出題強化**: 単語の `stats.accuracy` を重みとして出題頻度を調整。連続プレイでも弱点集合を持ち越す。
- **入力体験**: 高速タイプのデバウンス/キューイング、`n/nn` や `ltsu` など追加バリエーション許容。
- **メトリクス拡充**: セッション履歴保存、WPM/ACC推移グラフ、1分あたりの正答数など。
- **UI/レスポンシブ**: ミニウィジェット時の折返し・省略・メトリクス縦積み。~~ショートカット表示~~ → ✅ 実装済み。
- **テスト**: 変換/検証ロジックの単体テスト、ゲームループのタイマー精度テスト、ローカルストレージ永続化のリグレッションテスト。

## 追加ドキュメント計画
- 機能別仕様書（弱点アルゴリズム・時間管理・入力検証の詳細）
- テスト計画/チェックリスト
- UX/デザインガイド（色/動きの定義とコンポーネント利用ルール）
- リリースノート（今後の改善ごとに追記）

本ドキュメントは最小版です。要望・変更点があれば追記します。

