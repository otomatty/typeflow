# PRD: エンジニア向けReactタイピングアプリ (コードネーム: **TypeFlow**)

## 1. 製品概要

開発作業の合間やビルドの待ち時間に、ブラウザの別ウィンドウで手軽に起動・練習できるWebアプリケーション。
ユーザー自身が登録した技術用語を、ウィジェットのような極小UIで、ゲーム感覚（寿司打ライクなルール）で反復練習し、指に定着させる。

## 2. ターゲットユーザーとユースケース

- **ターゲット**: 新しい言語・ライブラリの構文を覚えたいエンジニア。
- **ユースケース**:
  - メインモニタでVSCodeを開きつつ、サブモニタや画面の隅にこのアプリを「幅の狭い細長いウィンドウ」として配置し、隙間時間にプレイする。

## 3. コア機能要件

### 3.1 UI/UXデザイン (Widget-First Design)

画面占有率を極限まで下げるため、レスポンシブデザインを徹底し、**「高さ150px程度の極小ウィンドウ」でも全ての機能が破綻なく動作する**UIとする。

- **Mini Mode**:
  - ヘッダーやフッターを排除。
  - 画面中央に「日本語」「ローマ字」「制限時間ゲージ」のみを表示。
  - 余計な装飾を削ぎ落としたダークモードベースのミニマルデザイン。
- **Visual Feedback**:
  - タイプミス時は画面全体が一瞬赤くフラッシュ、またはウィンドウの枠が赤く光る（音が出せない環境への配慮）。

### 3.2 キーワード管理 (Auto-Processing)

- **登録フロー**:
  1.  登録画面（モーダルまたは専用ページ）で単語を入力。
  2.  **ブラウザ側での形態素解析**: `kuroshiro` (JSライブラリ) を使用し、サーバー通信なしで即座に「ふりがな」「ローマ字」を推論・生成。
  3.  プレビューが表示され、必要であればその場で修正して保存。
- **一括登録**: クリップボードからのペーストや、特定フォーマット（JSON/CSV）のテキスト貼り付けによる一括登録に対応。

### 3.3 ゲームロジック (Time Attack / Survival)

- **ルール**:
  - 1単語ごとに制限時間ゲージ（プログレスバー）が減少。
  - 入力完了で時間回復（または次へ遷移）、時間切れでゲームオーバー。
- **判定**:
  - ローマ字入力の揺らぎ許容（`si` / `shi`, `nn` / `n` など）を実装。
  - 正確率（Accuracy）とKPM（Keystrokes Per Minute）をリアルタイム計測。

### 3.4 復習・分析 (Review Cycle)

- **Instant Retry**: ゲームオーバー直後に、ミスした単語のみを再構成した「復習セット」を1キー（例: `Enter`）で開始できる。
- **Weakness Tracking**:
  - キーワードごとに「正解率」をデータベースに蓄積。
  - 正解率ワースト10の単語を重点的に出題する「苦手克服モード」を実装。

### 3.5 データ永続化 (Local-First)

- ユーザー登録やログインを不要とする。
- 全ての学習データ（単語リスト、成績）はブラウザの **IndexedDB** に保存。
- これにより、オフラインでも完全に動作し、エンジニアが嫌う「無駄な通信待ち」を排除する。

---

## 4. 技術スタック選定

開発効率とパフォーマンス、要件（特に日本語処理とローカル保存）を満たすための構成です。

- **Framework**: React (Vite)
  - 高速なHMRで開発体験が良い。
- **Language**: TypeScript
- **State Management**: Zustand
  - Reduxより軽量で、ゲームの状態管理（タイマー、入力判定）に適している。
- **Styling**: Tailwind CSS
  - 「極小ウィンドウ」へのレスポンシブ対応（Media Queries）が容易。
- **Database (Client-side)**: Dexie.js (IndexedDB wrapper)
  - ReactからSQLライクにデータを扱え、大量の学習履歴も高速に処理可能。
- **Japanese Processing**:
  - `kuroshiro` + `kuroshiro-analyzer-kuromoji`: 漢字→ひらがな変換。
  - 自作ユーティリティ or 軽量ライブラリ: ひらがな→ローマ字変換。

---

## 5. 画面構成案 (Wireframe)

ウィンドウサイズを自由に変更できるWebアプリの特性を活かしたレイアウトです。

### A. プレイ画面 (Play Screen) - 通常/極小サイズ共通

```text
+--------------------------------------------------+
|  Promise.all                                     |  <- 日本語/英語キーワード
|  p r o m i s e . a l l                           |  <- 入力ガイド（打った文字は薄くなる）
| [==========================            ]         |  <- 残り時間ゲージ（CSSアニメーション）
+--------------------------------------------------+
```

### B. 単語登録モーダル (Quick Add)

```text
+--------------------------------------------------+
| Add New Keyword                                  |
| Input: [ 非同期処理           ] -> Auto Generate |
| ------------------------------------------------ |
| Read : [ ひどうきしょり       ]                  |
| Romaji:[ hidoukishori         ]                  |
|                                                  |
| [Save(Enter)]  [Cancel(Esc)]                     |
+--------------------------------------------------+
```

---

## 6. データモデル設計 (IndexedDB / Dexie.js)

`words` テーブル（ストア）のスキーマ設計です。

| Field Name         | Type              | Description                               |
| :----------------- | :---------------- | :---------------------------------------- |
| `id`               | number (Auto Inc) | 主キー                                    |
| `text`             | string            | 表示単語 (例: "useEffect")                |
| `reading`          | string            | ふりがな (例: "ゆーずえふぇくと")         |
| `romaji`           | string            | タイピング用ローマ字 (例: "yu-zuefekuto") |
| `stats.correct`    | number            | 正解回数                                  |
| `stats.miss`       | number            | ミス回数                                  |
| `stats.lastPlayed` | Date              | 最終プレイ日時                            |
| `stats.accuracy`   | number            | (computed) 正解率                         |

---

## 7. 開発ロードマップ案

1.  **Project Setup**: Vite + React + Tailwind CSS + Dexie.js の環境構築。
2.  **Core Engine**:
    - キー入力イベントのハンドリング。
    - ローマ字判定ロジック（`s`, `h`, `i` と打った時に `shi` と `si` 両方を許容するロジックなど）。
3.  **Data Logic**:
    - Dexie.jsを用いたデータのCRUD実装。
    - `kuroshiro` を導入し、テキスト入力からローマ字を生成する機能の実装。
4.  **UI Implementation**:
    - ウィンドウ幅を狭めても崩れないレイアウトの実装。
    - ゲージアニメーションの実装。
5.  **Game Loop**:
    - タイマー処理、ゲームオーバー判定、リザルト表示の結合。
